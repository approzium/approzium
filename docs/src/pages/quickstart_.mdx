---
name: Quickstart
edit: false
route: /quickstart
---

# Quickstart
This guide will show you how to:
- Deploy the Authenticator.
- Store database credentials in Vault to be retrieved by the Authenticator.
- Connect to a Postgres database through the Approzium Python SDK.

## Deploying the Authenticator
Get the Authenticator binary [here](https://github.com/approzium/approzium/tree/develop/authenticator), then run it with
the environment variables `VAULT_ADDR` and `VAULT_TOKEN` set. These are example values, in real life we'd expect Vault to
be run elsewhere.
```shell
export VAULT_ADDR=http://localhost:8200
export VAULT_TOKEN=root
./authenticator
```

For availability, we recommend running the Authenticator in a long-running environment (such as an EC2 instance) rather
than in a short-lived environment (like in AWS Lambda).

### Storing Credentials in Vault
The Authenticator expects credentials for a single database user as a secret stored against the database user as the key.
The secret contains the database password and a set of IAM roles allowed to access the credentials in the following structure.
```shell
cat dbuser1-creds.json
{
    "dbuser1": {
        "password": "asdfghjkl",
        "iam_arns": [
            "arn:aws:iam::accountid:role/rolename1",
            "arn:aws:iam::accountid:role/rolename2"
        ]
    }
}
```

For database access to be granted to a caller, the caller's exact `iam_arn` must be listed, _unless_ the caller has assumed a role.
For assumed roles, either the role ARN or the assumed role ARN may be used to grant access.

Enable Vault KV Version 1 (see [Vault documentation](https://www.vaultproject.io/docs/secrets/kv/kv-v1) for more information).
```shell
vault secrets enable -path=approzium -version=1 kv
```

Put the secret at path `approzium/<DATABASE_HOST:DATABASE_PORT>` with your database user as the key.
```shell
vault write approzium/1.2.3.4:5432 @dbuser1-creds.json
```

## SDK Usage
Install the SDK in your client.
```shell
pip3 install approzium
```

Connect to your database as follows.
```python
from approzium import AuthClient
from approzium.psycopg2 import connect

# create an Authenticator client
auth = AuthClient('authenticator:6000')

# connect using Approzium's connect method without providing a password
conn = connect("host=1.2.3.4 user=dbuser1 dbname=mydb", authenticator=auth)

# use the connection as you typically would. very cool!
cur = conn.cursor()
cur.execute('SELECT 1')
```

## Configuration

Approzium is configured through environment variables.

- `APPROZIUM_HOST`: Defaults to `"127.0.0.1"`.
- `APPROZIUM_PORT`: Defaults to `"6000"`.
- `APPROZIUM_LOG_LEVEL`: Defaults to `"info"`. Supported selections are `"trace"`, `"debug"`,
    `"info"`, `"warn"`, `"error"`, `"fatal"`, and `"panic"`. Upper case may be used.
- `APPROZIUM_VAULT_TOKEN_PATH`: Optional, if set it will cause the latest Vault token to always
    be pulled from the given file. See more on using this option
    [here](https://learn.hashicorp.com/vault/identity-access-management/vault-agent-aws).

Approzium supports Vault as for storing credentials. To use Vault, at a minimum, the `VAULT_ADDR`
must be set. Either the `VAULT_TOKEN` or `APPROZIUM_VAULT_TOKEN_PATH` must be set, with the `VAULT_TOKEN`
taking precedence. Additional Vault configuration is supported, as described
[here](https://www.vaultproject.io/docs/commands#environment-variables).
